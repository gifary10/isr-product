<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Daftar Produk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      font-size: 14px;
      margin: 0;
      padding: 0;
      background-color: transparent !important;
      overflow: hidden;
    }
    .container {
      display: none; /* Sembunyikan header utama */
    }
    .floating-button-container {
      position: fixed;
      bottom: 15px;
      right: 15px;
      z-index: 1050;
    }
    .floating-button {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: #0d6efd;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      border: none;
    }
    .offcanvas {
      max-height: 80vh;
    }
    .offcanvas-body {
      padding: 0.8rem;
      overflow-y: auto;
    }
    .accordion-button {
      padding: 0.8rem 1rem;
      font-size: 0.9rem;
    }
    .accordion-body {
      padding: 0.8rem;
    }
  </style>
</head>
<body>

  <!-- Floating Button -->
  <div class="floating-button-container">
    <button class="floating-button" 
            data-bs-toggle="offcanvas" 
            data-bs-target="#offcanvasAccordion" 
            aria-controls="offcanvasAccordion">
      <i class="bi bi-cart"></i>
    </button>
  </div>

  <!-- Offcanvas Panel -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasAccordion" aria-labelledby="offcanvasAccordionLabel">
    <div class="offcanvas-header py-2">
      <h5 class="offcanvas-title" style="font-size: 1.1rem;" id="offcanvasAccordionLabel">Daftar Produk</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-2">
      <div class="mb-2">
        <div class="btn-group btn-group-sm" role="group" id="kategoriToggle">
          <!-- Tombol akan di-generate oleh JavaScript -->
        </div>
      </div>
      <div id="accordionData" class="accordion"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbx9ausjurVQe4wWOdc9b_3PXrw_K14QEaZ4mOWtRc-iHG2zpZDCM1a0cEGQ_KXhzaMt9A/exec";

    let allData = [];

    fetch(scriptURL)
      .then(res => res.json())
      .then(data => {
        allData = data;
        renderKategoriToggle(data);
        renderAccordion(data);
      })
      .catch(error => {
        console.error("Gagal memuat data:", error);
        const accordion = document.getElementById("accordionData");
        accordion.innerHTML = `
          <div class="alert alert-danger py-2 px-3" style="font-size: 0.8rem;">
            Gagal memuat data. Silakan coba lagi nanti.
          </div>`;
      });

    function renderKategoriToggle(data) {
      const container = document.getElementById("kategoriToggle");
      container.innerHTML = '';

      // Tambahkan tombol "Semua"
      const semuaBtn = document.createElement("button");
      semuaBtn.className = "btn btn-outline-primary active";
      semuaBtn.dataset.kategori = "Semua";
      semuaBtn.textContent = "Semua";
      container.appendChild(semuaBtn);

      // Ambil kategori unik
      const kategoriSet = [...new Set(data.map(item => item.Kategori))]
                        .filter(kat => kat && kat.trim() !== "");

      // Tambahkan tombol kategori
      kategoriSet.forEach(kat => {
        const btn = document.createElement("button");
        btn.className = "btn btn-outline-primary";
        btn.dataset.kategori = kat;
        btn.textContent = kat;
        container.appendChild(btn);
      });

      // Event listener untuk filter
      container.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          container.querySelectorAll("button").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");

          const selected = btn.dataset.kategori;
          if (selected === "Semua") {
            renderAccordion(allData);
          } else {
            const filtered = allData.filter(item => item.Kategori === selected);
            renderAccordion(filtered);
          }
        });
      });
    }

    function renderAccordion(data) {
      const accordion = document.getElementById("accordionData");
      accordion.innerHTML = "";

      if (!data || data.length === 0) {
        accordion.innerHTML = "<p class='text-muted text-center py-2' style='font-size: 0.85rem;'>Tidak ada data</p>";
        return;
      }

      data.forEach((item, index) => {
        const collapseId = `collapse${index}`;
        const headerId = `heading${index}`;

        // Handle status aplikasi
        let statusButton = '';
        if (item.Status && item.Link) {
          const status = item.Status.toLowerCase();
          const isActive = status.includes('aktif');
          
          statusButton = isActive
            ? `<a href="${item.Link}" target="_blank" class="btn btn-sm btn-success py-1 px-2" style="font-size: 0.75rem;">
                 <i class="bi bi-box-arrow-up-right me-1"></i> ${item.Status}
               </a>`
            : `<a href="${item.Link}" target="_blank" class="btn btn-sm btn-warning py-1 px-2" style="font-size: 0.75rem;">
                 ${item.Status}
               </a>`;
        } else {
          statusButton = `<button class="btn btn-sm btn-outline-secondary py-1 px-2" disabled style="font-size: 0.75rem;">
                            ${item.Status || 'Tidak Tersedia'}
                          </button>`;
        }

        accordion.innerHTML += `
          <div class="accordion-item">
            <h2 class="accordion-header" id="${headerId}">
              <button class="accordion-button collapsed py-2" type="button" 
                      data-bs-toggle="collapse" data-bs-target="#${collapseId}" 
                      aria-expanded="false" aria-controls="${collapseId}">
                <span class="fw-bold" style="font-size: 0.85rem;">${item['Nama Aplikasi'] || 'Produk Tanpa Nama'}</span>
                <span class="badge bg-info ms-1" style="font-size: 0.7rem;">${item.Kategori || 'Umum'}</span>
              </button>
            </h2>
            <div id="${collapseId}" class="accordion-collapse collapse" 
                 aria-labelledby="${headerId}" data-bs-parent="#accordionData">
              <div class="accordion-body py-2">
                <p class="mb-2" style="font-size: 0.8rem;">${item.Deskripsi || 'Tidak ada deskripsi'}</p>
                <div class="d-flex justify-content-between align-items-center">
                  ${statusButton}
                  <small class="text-muted" style="font-size: 0.7rem;">${item['Tanggal Update'] || ''}</small>
                </div>
              </div>
            </div>
          </div>
        `;
      });
    }
  </script>
</body>
</html>
