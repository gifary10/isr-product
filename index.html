<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CRUD Aplikasi K3</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h4 class="text-center mb-4">Manajemen Aplikasi K3</h4>

    <form id="appForm" class="card p-3 mb-3 shadow-sm">
      <input type="hidden" id="rowId">
      <div class="mb-2">
        <label>Kategori</label>
        <input type="text" id="kategori" class="form-control" required>
      </div>
      <div class="mb-2">
        <label>Nama Aplikasi</label>
        <input type="text" id="nama" class="form-control" required>
      </div>
      <div class="mb-2">
        <label>Deskripsi</label>
        <textarea id="deskripsi" class="form-control" required></textarea>
      </div>
      <div class="mb-2">
        <label>Status</label>
        <select id="status" class="form-select">
          <option>Beli</option>
          <option>Coming Soon</option>
          <option>Dalam Pengembangan</option>
        </select>
      </div>
      <div class="mb-2">
        <label>Link</label>
        <input type="url" id="link" class="form-control">
      </div>
      <button type="submit" class="btn btn-primary w-100">Simpan</button>
    </form>

    <div id="dataTable" class="table-responsive"></div>
  </div>

  <script>
    const scriptURL = "PASTE_YOUR_SCRIPT_URL_HERE";

    function loadData() {
      fetch(`${scriptURL}?action=getData`)
        .then(res => res.json())
        .then(data => {
          let html = `<table class="table table-sm table-bordered bg-white">
            <thead><tr>
              <th>Kategori</th><th>Nama</th><th>Status</th><th>Link</th><th>Aksi</th>
            </tr></thead><tbody>`;
          data.forEach(item => {
            html += `<tr>
              <td>${item.kategori}</td>
              <td><strong>${item.nama}</strong><br><small>${item.deskripsi}</small></td>
              <td><span class="badge bg-info">${item.status}</span></td>
              <td><a href="${item.link}" target="_blank">Link</a></td>
              <td>
                <button class="btn btn-warning btn-sm" onclick="editRow('${item.id}', '${item.kategori}', '${item.nama}', \`${item.deskripsi}\`, '${item.status}', '${item.link}')">Edit</button>
                <button class="btn btn-danger btn-sm" onclick="deleteRow('${item.id}')">Hapus</button>
              </td>
            </tr>`;
          });
          html += `</tbody></table>`;
          document.getElementById("dataTable").innerHTML = html;
        });
    }

    function editRow(id, kategori, nama, deskripsi, status, link) {
      document.getElementById("rowId").value = id;
      document.getElementById("kategori").value = kategori;
      document.getElementById("nama").value = nama;
      document.getElementById("deskripsi").value = deskripsi;
      document.getElementById("status").value = status;
      document.getElementById("link").value = link;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function deleteRow(id) {
      if (confirm("Yakin ingin menghapus data ini?")) {
        fetch(scriptURL, {
          method: 'POST',
          body: JSON.stringify({ action: "delete", id: id })
        }).then(res => res.text()).then(() => loadData());
      }
    }

    document.getElementById("appForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const id = document.getElementById("rowId").value;
      const data = {
        action: id ? "update" : "add",
        id: id,
        kategori: document.getElementById("kategori").value,
        nama: document.getElementById("nama").value,
        deskripsi: document.getElementById("deskripsi").value,
        status: document.getElementById("status").value,
        link: document.getElementById("link").value
      };

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(data)
      }).then(res => res.text()).then(() => {
        document.getElementById("appForm").reset();
        document.getElementById("rowId").value = "";
        loadData();
      });
    });

    loadData();
  </script>
</body>
</html>
