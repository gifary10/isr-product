<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Daftar Aplikasi - Accordion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container py-4">
    <h2 class="text-center">Daftar Aplikasi</h2>
    <p class="text-center">Klik tombol di kanan bawah untuk melihat daftar aplikasi.</p>
  </div>

  <!-- Floating Button -->
  <button class="btn btn-primary rounded-circle position-fixed" 
          style="bottom: 20px; right: 20px; width: 60px; height: 60px; z-index: 1050;" 
          data-bs-toggle="offcanvas" 
          data-bs-target="#offcanvasAccordion" 
          aria-controls="offcanvasAccordion">
    <i class="bi bi-list fs-4"></i>
  </button>

  <!-- Offcanvas Panel -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasAccordion" aria-labelledby="offcanvasAccordionLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasAccordionLabel">Daftar Aplikasi</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">

      <!-- Toggle Kategori -->
      <div class="mb-3">
        <div class="btn-group" role="group" id="kategoriToggle">
          <button class="btn btn-outline-primary active" data-kategori="Semua">Semua</button>
        </div>
      </div>

      <!-- Accordion -->
      <div id="accordionData" class="accordion"></div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JavaScript Loader -->
  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbx9ausjurVQe4wWOdc9b_3PXrw_K14QEaZ4mOWtRc-iHG2zpZDCM1a0cEGQ_KXhzaMt9A/exec";

    let allData = [];

    fetch(scriptURL)
      .then(res => res.json())
      .then(data => {
        allData = data;
        renderKategoriToggle(data);
        renderAccordion(data);
      })
      .catch(error => {
        console.error("Gagal memuat data:", error);
        document.getElementById("accordionData").innerHTML = "<p class='text-danger'>Gagal memuat data.</p>";
      });

    function renderKategoriToggle(data) {
      const kategoriSet = new Set(data.map(item => item.Kategori).filter(Boolean));
      const container = document.getElementById("kategoriToggle");

      kategoriSet.forEach(kat => {
        const btn = document.createElement("button");
        btn.className = "btn btn-outline-primary";
        btn.dataset.kategori = kat;
        btn.textContent = kat;
        container.appendChild(btn);
      });

      container.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          container.querySelectorAll("button").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");

          const selected = btn.dataset.kategori;
          if (selected === "Semua") {
            renderAccordion(allData);
          } else {
            const filtered = allData.filter(item => item.Kategori === selected);
            renderAccordion(filtered);
          }
        });
      });
    }

    function renderAccordion(data) {
      const accordion = document.getElementById("accordionData");
      accordion.innerHTML = "";

      if (data.length === 0) {
        accordion.innerHTML = "<p class='text-muted'>Tidak ada data untuk kategori ini.</p>";
        return;
      }

      data.forEach((item, index) => {
        const collapseId = `collapse${index}`;
        const headerId = `heading${index}`;

        const statusButton = item.Status?.toLowerCase() === 'aktif' && item.Link
          ? `<a href="${item.Link}" target="_blank" class="btn btn-sm btn-outline-success">${item.Status}</a>`
          : `<button class="btn btn-sm btn-outline-secondary" disabled>${item.Status || 'Tidak Aktif'}</button>`;

        const card = `
          <div class="accordion-item">
            <h2 class="accordion-header" id="${headerId}">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${collapseId}" aria-expanded="false" aria-controls="${collapseId}">
                ${item['Nama Aplikasi'] || 'Tanpa Nama'} (${item.Kategori || '-'})
              </button>
            </h2>
            <div id="${collapseId}" class="accordion-collapse collapse" aria-labelledby="${headerId}" data-bs-parent="#accordionData">
              <div class="accordion-body">
                <p><strong>Deskripsi:</strong> ${item.Deskripsi || '-'}</p>
                <p><strong>Status:</strong> ${statusButton}</p>
              </div>
            </div>
          </div>
        `;
        accordion.innerHTML += card;
      });
    }
  </script>
</body>
</html>
